<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, May 23, 2010, 7:11 PM -->
<!-- MuClient version 4.51 -->

<!-- Plugin "paste_capture" generated by Plugin Wizard -->

<muclient>
<plugin
   name="paste_capture"
   author="Tyler Spivey"
   id="59f56db8f4c0f8839d2656eb"
   language="Lua"
   purpose="Captures @pastes sent by moo servers"
   date_written="2010-05-23 19:09:54"
   requires="4.00"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   match="---------------------------------finished----------------------------------"
   script="savePaste"
   sequence="99"
  >
  </trigger>
  <trigger
   enabled="y"
   match="^-----+(.+?)------+$"
   regexp="y"
   script="start"
   sequence="100"
  >
  </trigger>
  <trigger
   match="*"
   name="capture"
   script="capture"
   sequence="100"
  >
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
function start(name, line, wc)
if wc[1]:find("^-+") then
return
end
username = wc[1]
lines = {}
EnableTrigger("capture", 1)
end

function capture(name, line, wc)
table.insert(lines, line)
end
function notepadExists(name)
local g = GetNotepadList()
if g == nil then return false end
for k,v in ipairs(g) do
if v == name then
return true
end
end
return false
end
function savePaste(name, line, wc)
local seq = 1
EnableTrigger("capture", 0)
function notepadName() return "paste " .. seq .. " from " .. username end
while notepadExists(notepadName()) do seq = seq + 1 end
SendToNotepad(notepadName(), table.concat(lines, "\r\n"))
Activate()
Note("Paste from " .. username .. " captured.")
end

]]>
</script>


</muclient>
